# pharm-clustering 단독 개발 환경

x-common-env: &common-env
  ES_HOST: host.docker.internal
  ES_PORT: ${ES_PORT:-54321}
  RDBMS_HOST: host.docker.internal
  RDBMS_PORT: ${RDBMS_PORT:-12345}
  RDBMS_DATABASE: ${RDBMS_DATABASE:-platpharm}
  RDBMS_USER: ${RDBMS_USER:-postgres}
  RDBMS_PASSWORD: ${RDBMS_PASSWORD:-}
  DATA_GO_KR_API_KEY: ${DATA_GO_KR_API_KEY:-}
  TZ: Asia/Seoul

services:
  # 전체 수집기 실행
  crawler-all:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pharm-crawler-all
    environment:
      <<: *common-env
    volumes:
      - ./crawler:/app/crawler
    command: ["python", "-m", "crawler.main", "--verbose"]

  # 특정 수집기만 실행 (예: 약국 데이터)
  crawler-pharmacy:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pharm-crawler-pharmacy
    environment:
      <<: *common-env
    volumes:
      - ./crawler:/app/crawler
    command: ["python", "-m", "crawler.main", "-c", "pharmacy_nic", "pharmacy_hira", "-v"]
    profiles:
      - pharmacy

  # 병원 데이터 수집기
  crawler-hospital:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pharm-crawler-hospital
    environment:
      <<: *common-env
    volumes:
      - ./crawler:/app/crawler
    command: ["python", "-m", "crawler.main", "-c", "hospital_nic", "hospital_hira", "-v"]
    profiles:
      - hospital

  # Dry-run 테스트
  crawler-test:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pharm-crawler-test
    environment:
      <<: *common-env
    volumes:
      - ./crawler:/app/crawler
    command: ["python", "-m", "crawler.main", "--dry-run", "-v"]
    profiles:
      - test
